{"version":3,"file":"js/projections-e7ae518a6f89fe5bc1db.js","sources":["webpack://ontrack/./app/javascript/components/projections/Main.jsx","webpack://ontrack/./app/javascript/components/projections/ProjectionsChart.jsx","webpack://ontrack/./app/javascript/packs/projections.jsx"],"sourcesContent":["import React from 'react';\r\nimport moment from 'moment';\r\nimport Overview from './Overview';\r\nimport CategoriesList from './CategoriesList';\r\nimport ExpenseFormModal from '../expenses/FormModal';\r\nimport PieChart from '../shared/PieChart';\r\nimport { Categories, Revenues, Expenses, Goals, Reports } from '../../api/main';\r\nimport { Alerts } from '../../helpers/main';\r\nimport ProjectionsChart from './ProjectionsChart';\r\n\r\nclass Main extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      categories: [],\r\n      expenses: [],\r\n      expensesWithPredictions: [],\r\n      sumExpenses: 0,\r\n      revenues: [],\r\n      sumRevenues: 0,\r\n      loaded: false,\r\n      monthlyGoal: 0,\r\n      showExpenseCreateModal: false,\r\n      data: [],\r\n      labels: [],\r\n      colors: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.reloadData();\r\n  }\r\n\r\n  openExpenseCreate = () => { this.setState({ showExpenseCreateModal: true }); }\r\n  closeExpenseCreate = () => { this.setState({ showExpenseCreateModal: false }); }\r\n  onExpenseSave = () => {\r\n    this.closeExpenseCreate();\r\n    this.reloadData();\r\n  }\r\n\r\n  reloadData = () => {\r\n    this.loadCategory();\r\n    this.loadExpensesData();\r\n    this.loadRevenueData();\r\n    this.loadPieChartData(moment().format('MMMM YYYY'));\r\n  }\r\n\r\n  loadCategory = () => {\r\n    Categories.list().then(\r\n      (cResp) => { this.setState({ categories: cResp }); },\r\n      () => { Alerts.error(\"Categories didn't load correctly\"); }\r\n    );\r\n  }\r\n\r\n  loadExpensesData = () => {\r\n    Expenses.list().then(\r\n      (eResp) => {\r\n        this.setState({ expenses: eResp });\r\n        Goals.list().then(\r\n          (gResp) => { this.setState({ loaded: true, monthlyGoal: gResp.monthly }); },\r\n          () => { Alerts.error(\"Goal of expenses didn't load!\"); },\r\n        );\r\n      },\r\n      () => { Alerts.error(\"Expenses didn't load correctly!\"); },\r\n    );\r\n  }\r\n\r\n  categoriesWithExpensesAndSpend() {\r\n    const categories = [];\r\n    this.state.categories.forEach((category) => {\r\n      category.expenses = this.state.expenses.filter((expense) => expense.category_id == category.id);\r\n      category.spend = category.expenses.reduce((sum, exp) => sum + exp.amount, 0);\r\n      categories.push(category);\r\n    });\r\n    return categories;\r\n  }\r\n\r\n  renderExpenseCreateModal() {\r\n    if (!this.state.showExpenseCreateModal) { return ''; }\r\n    return <ExpenseFormModal categories={this.state.categories} onClose={this.closeExpenseCreate} onSave={this.onExpenseSave} />;\r\n  }\r\n\r\n  loadRevenueData = () => {\r\n    Revenues.list({ paid_after: moment().startOf('month').unix() }).then(\r\n      (rResp) => {\r\n        this.setState({ revenues: rResp});\r\n      },\r\n      () => { Alerts.error(\"Revenues didn't load correctly!\") }\r\n    );\r\n  }\r\n\r\n  loadSum = () => {\r\n    var indexRev = 0;\r\n\r\n    this.state.categories.forEach((category) => {\r\n      if (category.is_revenue == 1) {\r\n        category.revenues = this.state.revenues.filter((revenue) => revenue.category_id == category.id);\r\n        category.revenues.forEach((revenue) => {\r\n          indexRev += revenue.amount;\r\n        });\r\n      }\r\n    });\r\n\r\n    return (indexRev/100);\r\n  }\r\n\r\n  loadPieChartData = (month) => {\r\n    Reports.month({ month }).then(\r\n      (resp) => {\r\n\r\n        const revenue = this.loadSum();\r\n        \r\n        const data = resp.category_pourcentage.map((r) => \r\n          Number.parseFloat((r.spend/revenue)*100).toFixed(3)\r\n        )\r\n        const labels = resp.category_pourcentage.map((r) => r.category)\r\n        const colors = resp.category_pourcentage.map((r) => r.color)\r\n\r\n        this.setState({ data: data });\r\n        this.setState({ labels: labels });\r\n        this.setState({ colors: colors });\r\n\r\n        return true;\r\n      },\r\n      () => { Alerts.error(\"The data for the pie chart didn't load correctly!\") }\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.loaded) { return ''; }\r\n    return (\r\n      <div className='container'>\r\n        <h1>Predictions for the next few months</h1>\r\n      {<ProjectionsChart categoriesWithExpensesAndSpend={this.categoriesWithExpensesAndSpend()} expenses={this.state.expenses} /> }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Main;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport moment from 'moment';\r\nimport { Numerics } from '../../helpers/main';\r\nimport Progress from '../shared/Progress';\r\nimport GoalFormModal from '../goals/FormModal';\r\n\r\nclass ProjectionsChart extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      distinctExpenses: [],\r\n      totalMonthlyChangePrediction: 0,\r\n      totalPerMonth: [],\r\n      variationPerMonth: [],\r\n      averageVariationPerMonth: 0,\r\n      totalPerNextMonthsPredictions: []\r\n    };\r\n  }\r\n\r\n\r\n  getexpense() {\r\n    {this.props.categoriesWithExpensesAndSpend.map(category => {\r\n      category.expenses.map(expense =>  {\r\n        // if (expense.description == \"Breakfast\")\r\n        // {\r\n          // this.setState(prevState => ({\r\n          //   expensestest: [...prevState.expensestest, expense]\r\n          // }))\r\n          console.log(expense.id)\r\n        // }\r\n      }\r\n      )\r\n    })}\r\n  }\r\n\r\n  getcategories() {\r\n    {this.props.categoriesWithExpensesAndSpend.map((category) =>\r\n      (console.log(category.name)))}\r\n\r\n\r\n  //   for (let expensesss of this.props.categoriesWithExpensesAndSpend) {\r\n  //     if (expensesss.name == \"T-Shirt sales\")\r\n  //     {\r\n  //       console.log(expensesss.name)\r\n  //     }\r\n  // }\r\n  }\r\n\r\n  getDistinctExpenses() {\r\n    {this.props.expenses.map((expense) =>\r\n      { \r\n        var d = new Date(expense.paid_at);\r\n        if (this.state.distinctExpenses.filter(e => e.id === expense.id).length == 0)\r\n        {\r\n          this.setState(prevState => ({\r\n            distinctExpenses: [...prevState.distinctExpenses, expense]\r\n          }))\r\n          //console.log(d.toString());\r\n        }\r\n        })}\r\n        for (let expense of this.state.distinctExpenses)\r\n        {\r\n          //console.log(expense.description)\r\n        }\r\n  }\r\n\r\n  getTotalMonthlyAmount() {\r\n    for (let i = 0; i < 5; i++)\r\n    {\r\n      this.state.totalPerMonth[i] = 0;\r\n      for (let expense of this.props.expenses) {\r\n        var d = new Date(expense.paid_at);\r\n        var currentTime = new Date();\r\n        if (d.getMonth() == (currentTime.getMonth() - 1 - i))\r\n        {\r\n          this.state.totalPerMonth[i] += (expense.amount / 100);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getAverageVariationPerMonth() {\r\n    for (let i = this.state.totalPerMonth.length - 2; i > -1; i--) {\r\n      this.state.variationPerMonth[i] = (this.state.totalPerMonth[i] - this.state.totalPerMonth[i + 1]);\r\n    }\r\n    const sum = this.state.variationPerMonth.reduce((partialSum, a) => partialSum + a, 0);\r\n    this.state.averageVariationPerMonth = sum / this.state.variationPerMonth.length;\r\n  }\r\n\r\n\r\n  getTotalExpensesProjections() {\r\n    for (let i = 0; i < 5; i++)\r\n    {\r\n      if (i == 0)\r\n      {\r\n        this.state.totalPerNextMonthsPredictions[i] = this.state.totalPerMonth[0] + this.state.averageVariationPerMonth;\r\n      }\r\n      else\r\n      {\r\n        this.state.totalPerNextMonthsPredictions[i] = this.state.totalPerNextMonthsPredictions[i - 1] + this.state.averageVariationPerMonth;\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.getTotalMonthlyAmount();\r\n    this.getAverageVariationPerMonth();\r\n    this.getTotalExpensesProjections();\r\n    const d = new Date();\r\n    const monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\r\n  \"July\", \"August\", \"September\", \"October\", \"November\", \"December\", \"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\r\n  \"July\", \"August\", \"September\", \"October\", , \"November\", \"December\"\r\n    ];\r\n    return (\r\n    <div>\r\n      <h3>Total expenses of the last few months</h3>\r\n\r\n      <table className='table'>\r\n        <tr>\r\n          <th>Month</th>\r\n          <th>Total expenses</th>\r\n          <th>Difference from last month</th>\r\n        </tr>\r\n\r\n        {this.state.totalPerMonth.map((value, index) => \r\n      (\r\n        <tr>\r\n          <td>{monthNames[(d.getMonth() - index - 1)]}</td>\r\n          <td>{value}</td>\r\n          <td>Test?</td>\r\n        </tr>))}\r\n      </table>\r\n\r\n\r\n      {this.state.totalPerMonth.map((value, index) => \r\n      (\r\n      <div>\r\n        <p>{monthNames[(d.getMonth() - index - 1)]}</p>\r\n        <p>{value}</p></div>))}\r\n\r\n        {this.state.variationPerMonth.map((value, index) => (\r\n          <div>\r\n            <p>Change from {monthNames[(d.getMonth() - index - 2)]} to {monthNames[(d.getMonth() - index - 1)]}</p>\r\n            {value >= 0 &&\r\n        <p>+{value}</p>\r\n      }\r\n        {value < 0 &&\r\n        <p>-{value}</p>\r\n      }\r\n          </div>\r\n        ))}\r\n\r\n\r\n      <h3>Projections of the total spendings of the next few months</h3>\r\n      {this.state.totalPerNextMonthsPredictions.map((value, index) => \r\n      (\r\n      <div>\r\n        <p>{monthNames[(d.getMonth() + index)]}</p>\r\n        <p>{value}</p></div>))}\r\n\r\n        \r\n    </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ProjectionsChart;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport ProjectionsMain from '../components/projections/Main';\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  ReactDOM.render(\r\n    <ProjectionsMain {...window.InitialProps} />,\r\n    document.getElementById('projections'),\r\n  );\r\n});\r\n"],"mappings":"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","sourceRoot":""}